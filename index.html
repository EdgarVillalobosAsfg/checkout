<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consulta de Recursos</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        var allData = []; // Almacena todos los datos para futuras búsquedas

        $(document).ready(function() {
            // Cargar los datos desde la API
            $.getJSON("https://script.google.com/macros/s/AKfycbycHQ06-Zf6U9yvvycOo7iL7C4SzM0pbMl4_WUQx94OsxrQW0_qnkdjRsghEpdLBvAfWw/exec", function(data) {
                allData = data; // Guardamos todos los datos en memoria
                $("#welcomeMessage").show(); // Mostrar mensaje de bienvenida
            }).fail(function() {
                $("#data").html("<p style='color:red;'>Error al cargar los datos desde la API.</p>");
            });

            // Manejar la búsqueda al enviar el formulario
            $("#searchForm").submit(function(event) {
                event.preventDefault();
                var searchValue = $("#searchInput").val().trim().toLowerCase();

                if (searchValue === "") {
                    alert("Por favor ingresa tu Nombre o EmployeeID.");
                    return;
                }

                // Convertir todas las claves a minúsculas para evitar errores
                var filteredData = allData.filter(function(item) {
                    var nombre = item.Usuario ? item.Usuario.toLowerCase() : "";
                    var employeeID = item.EmployeeID ? item.EmployeeID.toLowerCase() : "";
                    
                    return nombre.includes(searchValue) || employeeID.includes(searchValue);
                });

                if (filteredData.length > 0) {
                    displayTable(filteredData);
                    $("#welcomeMessage").hide(); // Ocultar mensaje de bienvenida
                } else {
                    $("#data").html("<p style='color:red;'>No se encontraron recursos asignados. Verifica que el nombre o ID estén bien escritos.</p>");
                }
            });
        });

        // Función para mostrar los datos en tabla
        function displayTable(data) {
            var headers = Object.keys(data[0]);
            var table = "<table border='1' width='100%'><thead><tr>";

            // Crear encabezados de forma dinámica
            $.each(headers, function(index, header) {
                table += "<th>" + header + "</th>";
            });

            table += "</tr></thead><tbody>";

            // Agregar filas dinámicamente
            $.each(data, function(key, value) {
                table += "<tr>";
                $.each(headers, function(index, header) {
                    var cellData = value[header] || "";
                    
                    // Si la columna es "Asset Photo", mostrar la imagen en lugar del enlace
                    if (header.toLowerCase() === "asset photo" && cellData.startsWith("http")) {
                        table += "<td><img src='" + cellData + "' width='100' height='100'></td>";
                    } else {
                        table += "<td>" + cellData + "</td>";
                    }
                });
                table += "</tr>";
            });

            table += "</tbody></table>";
            $("#data").html(table);
        }
    </script>
</head>
<body>
    <h2>Consulta de Recursos</h2>

    <!-- Mensaje de Bienvenida -->
    <div id="welcomeMessage" style="display:none;">
        <h3>Bienvenido, por favor ingresa tu Nombre o EmployeeID para consultar tus recursos asignados.</h3>
    </div>

    <!-- Formulario de Búsqueda -->
    <form id="searchForm">
        <label for="searchInput">Ingresa tu Nombre o EmployeeID:</label>
        <input type="text" id="searchInput" required>
        <button type="submit">Buscar</button>
    </form>

    <!-- Contenedor donde se mostrarán los datos -->
    <div id="data"></div>
</body>
</html>

